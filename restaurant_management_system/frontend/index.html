<!DOCTYPE html>
<html lang="en">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - RMS</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app-layout">
        <div id="sidebar-container"></div>
        <main class="main-content">
            <div class="container">
                    <h1>Dashboard</h1>
                    <div class="flex items-center gap-2">
                        <span style="color: var(--text-muted); font-size: 0.9rem;">Role:</span>
                        <span id="user-role-badge" class="badge badge-primary" style="background: rgba(99, 102, 241, 0.15); color: #818cf8; border: 1px solid rgba(99, 102, 241, 0.3); text-transform: uppercase;">-</span>
                    </div>
                </div>
                
                <!-- Stats Grid -->
                <div class="grid gap-4" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); margin-bottom: 3rem;">
                    <!-- Active Orders Card -->
                    <div class="card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 style="margin: 0; font-size: 0.875rem; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Active Orders</h3>
                                <p id="active-orders-count" style="font-size: 2.5rem; font-weight: 700; color: white; margin: 0.5rem 0 0; line-height: 1;">-</p>
                            </div>
                            <div style="background: rgba(99, 102, 241, 0.1); padding: 0.75rem; border-radius: 0.75rem; color: #818CF8;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #34D399;">
                            <span style="color: var(--text-muted);">Current active orders</span>
                        </div>
                    </div>

                    <!-- Low Stock Card -->
                    <div class="card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 style="margin: 0; font-size: 0.875rem; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Low Stock Items</h3>
                                <p id="low-stock-count" style="font-size: 2.5rem; font-weight: 700; color: white; margin: 0.5rem 0 0; line-height: 1;">-</p>
                            </div>
                            <div style="background: rgba(248, 113, 113, 0.1); padding: 0.75rem; border-radius: 0.75rem; color: #F87171;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #F87171;">
                            <span style="font-weight: 600;">Action Needed</span>
                            <span style="color: var(--text-muted);">Restock soon</span>
                        </div>
                    </div>

                    <!-- Revenue Card -->
                    <div class="card">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 style="margin: 0; font-size: 0.875rem; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Total Revenue</h3>
                                <p id="total-revenue" style="font-size: 2.5rem; font-weight: 700; color: white; margin: 0.5rem 0 0; line-height: 1;">-</p>
                            </div>
                            <div style="background: rgba(52, 211, 153, 0.1); padding: 0.75rem; border-radius: 0.75rem; color: #34D399;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #34D399;">
                            <span style="color: var(--text-muted);">Total earnings</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <h2>Quick Actions</h2>
                <div class="grid gap-4" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <a href="orders.html" id="action-new-order" class="card" style="text-decoration: none; text-align: center; transition: all 0.3s;">
                        <div style="background: rgba(99, 102, 241, 0.1); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: #818CF8;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        </div>
                        <h3 style="font-size: 1rem; margin: 0; color: white;">New Order</h3>
                    </a>
                    <a href="menu.html" id="action-update-menu" class="card" style="text-decoration: none; text-align: center; transition: all 0.3s;">
                        <div style="background: rgba(244, 114, 182, 0.1); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: #F472B6;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3zm0 0v7"/></svg>
                        </div>
                        <h3 style="font-size: 1rem; margin: 0; color: white;">Update Menu</h3>
                    </a>
                    <a href="inventory.html" id="action-check-inventory" class="card" style="text-decoration: none; text-align: center; transition: all 0.3s;">
                        <div style="background: rgba(52, 211, 153, 0.1); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: #34D399;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                        </div>
                        <h3 style="font-size: 1rem; margin: 0; color: white;">Check Inventory</h3>
                    </a>
                </div>
            </div>
        </main>
    </div>
    <script src="auth.js"></script>
    <script src="api.js"></script>
    <script src="main.js"></script>
    <script>
        requireAuth();
        
        async function loadStats() {
            // Fetch Orders
            const ordersRes = await apiRequest('/orders/orders/');
            if (ordersRes && ordersRes.ok) {
                const orders = await ordersRes.json();
                
                // Active Orders
                const activeOrders = orders.filter(o => o.status !== 'COMPLETED' && o.status !== 'CANCELLED').length;
                document.getElementById('active-orders-count').innerText = activeOrders;
                
                // Total Revenue
                const revenue = orders
                    .filter(o => o.status === 'COMPLETED')
                    .reduce((sum, o) => sum + parseFloat(o.total_price), 0);
                document.getElementById('total-revenue').innerText = 'â‚¹' + revenue.toFixed(2);
            }
            
            // Fetch Inventory
            const inventoryRes = await apiRequest('/inventory/items/');
            if (inventoryRes && inventoryRes.ok) {
                const items = await inventoryRes.json();
                const lowStock = items.filter(i => i.is_low_stock).length;
                document.getElementById('low-stock-count').innerText = lowStock;
            }
        }
        
        loadStats();
    </script>
</body>
</html>
